\section{Characterizing Mobile Traffic}
\label{sec:measurement-results}

%\subsection{Dataset Description}
%\label{sec:dataset-description}
%
%- IRB based study from September 2012. 
%- Full packet capture
%- Currently serves 20 devices from 14 users, 8 Android, 12 iOS device,    
%  4 iPads, 7 iPhones, and 1 iPod Touch.
%  15 service providers spread across US and France.
%- 30.2 GB of Traffic Volume from November 1, 2012

\subsection{Summary Statistics}
\label{sec:initial-results}

In this section, we use several descriptive statistics to 
summarize our dataset and provide context for the remainder 
of the section.

Objective  coverage of meddle across access technology and devices 

I plan to use these two tables to introduce the results in the
following sections.


\begin{table}
\begin{center}
\begin{tabular}{|l|l|r|r|r|r|}
\hline
\multirow{2}{*}{\bf Protocol} & \multirow{2}{*}{\bf Service} & \multicolumn{2}{|c|}{\bf Android} & \multicolumn{2}{|c|}{\bf iOS} \tabularnewline
\cline{3-6}
           &           &  \textbf{Flows}  &  \textbf{Bytes}  &  \textbf{Flows}  &  \textbf{Bytes}  \tabularnewline
\hline
 TCP       &  HTTP     &  14.87  &  74.31  &  16.07  &  82.01  \tabularnewline
\hline
TCP       &  SSL      &  37.19  &  24.35  &  37.64  &  17.31  \tabularnewline
\hline
 UDP       &  -        &  40.52  &   0.98  &  42.34  &   0.49  \tabularnewline
\hline
 TCP       &  other    &   2.08  &   0.22  &   1.13  &   1.89  \tabularnewline
\hline
 Other     &  -        &   5.35  &   0.14  &   2.82  &   0.09  \tabularnewline
\hline
\multicolumn{2}{|c|}{\emph{total}} & 100.00 & 100.00 & 100.00 & 100.00 \tabularnewline
\hline
\end{tabular}
\end{center}
\caption{Percentage of flows and bytes from iOS and Android devices. \tbd{Verify total 100
    for final results} \emph{SSL is responsible for the majority of
    TCP flows from iOS and Android devices.}} 
\label{tab:summaryIOSAndroidTraffic}
\end{table}

In \fref{tab:summaryIOSAndroidTraffic}.

We classify the IP flows as either TCP, UDP, or other; all IP flows
that cannot be classified as either TCP or UDP are classified as
other. We further classify TCP flows as either HTTP, SSL, or
other. The SSL flows include HTTPS, IMAP, and other services that rely
on SSL to secure the connection between the mobile client and the
remote server. TCP flows that are not classified
as either HTTP or SSL are classified as other.  

In our traces we observe that DNS is responsible for more 93.5\% of
the UDP flows. The rest of the flows are due to services such as
Skype which is not widely used by users in our dataset. 
%421310/449421 

HTTP is the dominant protocol of traffic. SSL flows outnumber the HTTP
flows however the bytes per SSL flow is significantly smaller than the
bytes per HTTP flow. This is because of the media content from
streaming sites such as YouTube and Netflix is streamed over HTTP. 

\begin{table}
\begin{center}
\begin{tabular}{|l|l|r|r|r|r|}
\hline
\multirow{2}{*}{\bf Protocol} & \multirow{2}{*}{\bf Service} & \multicolumn{2}{|c|}{\bf Wi-Fi} & \multicolumn{2}{|c|}{\bf Cellular} \tabularnewline
\cline{3-6}
           &           &  \textbf{Flows}  &  \textbf{Bytes}  &  \textbf{Flows}  &  \textbf{Bytes}  \tabularnewline
\hline
 TCP       &  HTTP     &  16.91  &  83.52  &  13.03  &  56.14  \tabularnewline
\hline
 TCP       &  SSL      &  38.18  &  15.83  &  36.14  &  41.42  \tabularnewline
\hline
UDP       &  -        &  41.43  &   0.49  &  41.56  &   1.67  \tabularnewline
\hline
TCP       &  other    &   1.38 &   0.16  &   1.95  &   0.4  \tabularnewline
\hline
Other     &  -        &   2.12  &  0.01  &   7.2  &   0.3  \tabularnewline
\hline
\multicolumn{2}{|c|}{\emph{total}} & 100.00 & 100.00 & 100.00 & 100.00 \tabularnewline
\hline
\end{tabular}
\end{center}
\caption{Percentage of flows and bytes using Wi-Fi and Cellular as access technology. \tbd{Verify total 100
    for final results} \emph{The share of SSL traffic over Cellular
    networks is larger than its share over Wi-Fi.}}  
\label{tab:summaryWifiCellularTraffic}
\end{table}


In \fref{tab:summaryWifiCellularTraffic}.

7.2 of cellular traffic classified as other is an artifact of our user base that includes
researchers who tend to troubleshoot connectivity issues using icmp packets.

Though the fraction of flows for HTTP over Wi-Fi and Cellular remain
the same, the byte shares are different. This is because Wi-Fi is the
prefered medium to transfer media content. The flows that transfer media content
typically have more bytes compared to flows that do not contain media
content. 

SSL traffic is typically compressed - discussion on compression
opportunities for HTTP over Cellular networks refer to section ... for
more details. We can refer to this section to introduce
compression.

The increase in HTTP traffic over Wi-Fi is also because apps such as
Google Plus (image backup on Android) allow users to upload their
images only over Wi-Fi.


\subsection{Case Study: Device Specific Apps (iOS Push)}
\label{sec:case-study-ios}

In this section we present the results of a detailed case study 
of iOS push. We focus on this application because it represents 
an OS-managed service on an operating system that received 
little research attention due to its closed-source nature. 

We set out to answer the following questions: (1) What is the 
empirical network impact of push notifications and does the 
measured activity coincide with published documentation?
(2) Using \meddle, is there any relevant data traffic that is 
not captured by the VPN tunnel? (3) What is the impact of 
a VPN connection on network behavior? (4) Can we use 
network traffic alone to infer the state of the device?

\noindent \textbf{iOS Push Under the Microscope.} 
The Apple Push Notification Service 
(APNS) implements push for iOS. The documentation for APNS provides limited details about 
the implementation, but does specify expected behavior (\eg push 
connections are established over cellular connections even if 
\wifi is available). 

We explicitly verified all provided documentation and confirmed that 
all statements are true with the exception of notification behavior 
with an iPad. The documentation states that the iPad will always 
remain associated with a \wifi AP, even if it is not plugged in. Our 
experience show this is not the case.

\tbd{Are we sure that devices are getting SMS notifications to connect to an apple server?}
When a push notification is received, the iOS device connects to port
5223 of a nearby Apple server. For each iOS device in our dataset we
logged the timestamp at which these connections were established. From
this set of connections we then selected the connections established
between midnight at 6 am of the users local time. For each user, we
computed the median of time interval between successive
connections. We observe this median to be in the range of 190 seconds
to 590 seconds. This time interval depends on the different apps for
which the user has enabled notifications. 
\tbd{Add figure}

A user can disable notifications for specific time intervals on
devices running iOS 6. In our dataset, three devices had notification
disabled during different time intervals. During these time intervals
we did not observe any traffic for notifications.

\noindent\textbf{Impact of a VPN and power state.}
In the remainder of this section we perform controlled experiments 
to understand the impact of a VPN connection, the power state and 
the available access technologies on the network traffic generated 
by APNS. In summary, we find that the impact of the VPN depends 
on the power state and access technology -- but there exist cases 
where the VPN does not noticeably change network traffic from APNS.
Further, we find that these changes in traffic patterns are relatively 
easy to identify, meaning we can use traffic from \meddle to infer 
when a device is plugged in and which access technologies are 
available.

All the following experiments are performed on an \iphone 4 with iOS
6.0.1.  At the beginning of each experiment we close all applications
and restart the \iphone{}. The \iphone{} is connected in \wifi{} to a
controlled access point on which we perform a tcpdump on the \wifi{}
interface and monitor the \wifi{} association between the access point
and the \iphone{}. Each experiment lasts for around 1 hour. 

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_novpn_interTs.eps}
  \caption{Distribution of the interarrival times of Ethernet frames
    for a one hour experiment with an idle \iphone{} plugged-in, with \wifi{} and 3G
    enabled, and no VPN enabled. For each bin of 1 second, we count
    the number of interarrivals in that bin.}
  \label{fig:push_w3p_interTs}
\end{figure}

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_novpn_ts.eps}
%        \caption{Cumulative distribution of the Ethernet frames
%          arrival with time for a one hour experiment with an idle
%          \iphone{} plugged-in, with \wifi{} and 3G enabled, and no VPN
%          enabled.}
%  \label{fig:push_w3p_ts}
%\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_vpn_interTs.eps}
  \caption{Distribution of the interarrival times of Ethernet frames
    for a one hour experiment with an idle \iphone{} plugged-in, with \wifi{} and 3G
    enabled, and VPN enabled. For each bin of 1 second, we count
    the number of interarrivals in that bin.}
  \label{fig:push_w3pv_interTs}
\end{figure}

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_vpn_ts.eps}
%  \caption{Cumulative distribution of the Ethernet frames
%          arrival with time for a one hour experiment with an idle
%          \iphone{} plugged-in, with \wifi{} and 3G enabled, and VPN
%          enabled.}
%  \label{fig:push_w3pv_ts}
%\end{figure}

\emph{Behavior when plugged in.} When an \iphone{} is plugged-in, it always remains associated with the
\wifi{} access point if \wifi{} is enabled on the device. We performed
a first set of experiments to observe the traffic to and from an idle
\iphone{}. We see in Fig.~\ref{fig:push_w3p_interTs} and
Fig.~\ref{fig:push_w3pv_interTs} that the largest interarrival between
two frames is in the order of 10 seconds for both the VPN and no VPN
scenarios. We also observe no noticeable difference in the arrival of
frames with time for both the VPN (see Fig.~\ref{fig:push_w3pv_ts} and
no VPN (see Fig.~\ref{fig:push_w3p_ts}) scenarios. \emph{Thus, it 
appears that the VPN connection has no noticeable impact on 
network traffic generated for APNS when the device is plugged in.}

%We don't claim this
%traffic to be typical, in particular, our access point is a Windows 7
%machine sending SSDP traffic to announce available services. Instead,
%we use it to understand in our experimental setup the background
%traffic.

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_novpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{} and 3G
%    enabled, and no VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_w3_interTs}
%\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_novpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} and 3G enabled, and no VPN
          enabled.}
  \label{fig:push_w3_ts}
\end{figure}

\emph{Behavior when on battery.} 
In a second set of experiments, we consider a default \iphone{}
setting with 3G and \wifi{} enabled, and the \iphone{} unplugged. This
corresponds to a typical setting for a user on move.  We observe in
Fig.~\ref{fig:push_w3_interTs} some very large interarrival
times for frames. All interarrival times larger than 10 seconds correspond to
periods during which the \wifi interface of the \iphone{} is not
associated to the access point for energy saving. 




%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_novpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{} 
%    enabled, and no VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_w_interTs}
%\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_novpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} enabled, and no VPN
          enabled.}
  \label{fig:push_w_ts}
\end{figure}

Surprisingly, even though \iphone{} is idle, the traffic pattern
is not regular (Fig.~\ref{fig:push_w3_ts}). To
understand this irregularity, we made a new experiment with 3G
disabled. We observe in Fig.~\ref{fig:push_w_interTs} that the largest
interarrival is still in the order of 550 seconds, as in the case with
3G enabled, but we have less variety in the interarrival times. This
is confirmed by Fig.~\ref{fig:push_w_ts} that shows a regular
succession of short periods during which frames are received and long
periods during which the wifi connection is not associated to the
access point.

Therefore, there is an evidence that the 3G connection might trigger
the association of the \iphone{} \wifi interface with the access
point. This is confirmed by experiments we performed with iMessage
that is using the push notification infrastructure of Apple. When both
3G and \wifi{} are enabled on an \iphone{}, a permanent connection to
the push notification infrastructure of Apple is setup on the 3G
interface. Each time an iMessage is received, it is piggybacked on the
push notification message (when short enough). Interestingly, the \wifi{}
interface is always woken-up even if no payload is sent on it. \tbd{Is it 
fair to say this is wasted energy?}

In conclusion, there is evidence that some APNS signaling occurs 
outside of the packet-switched network. Thus, though \meddle appears 
to capture all IP traffic it may miss traffic in the circuit switched network 
that, in turn, causes IP traffic to occur.

%We observed this same behavior on the tcpdump traces used to plot
%Fig.~\ref{fig:push_w3_ts}. We observe that the \wifi{} interface is
%woken-up (we observe a specific ARP and DHCP exchange that takes place
%for each \wifi{} association to the access point), but no payload is
%exchanged. In this case, as we do not use a VPN, we cannot monitor the
%3G traffic using \meddle{}, but we guess that traffic received on the
%3G interface trigger the wake of the \wifi{} interface. We plan to
%further explore this issue. 

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_vpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{}
%    enabled, and VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_wv_interTs}
%\end{figure}




\emph{Behavior when switching access technologies.} We performed a third set of experiments with the VPN enabled. This set
of experiment shows the impact of using \meddle on the traffic pattern
and the power management policy. We see in
Fig.~\ref{fig:push_wv_interTs} and Fig.~\ref{fig:push_wv_ts} that
there is no noticeable differences when enabling \meddle with \wifi{} only. However,
when enabling both \wifi and 3G the frames interarrival time
(Fig.~\ref{fig:push_w3v_interTs}) and the cumulative arrival of frames
(Fig.~\ref{fig:push_w3v_ts}) is significantly different. 
\tbd{It will probably be too short for the deadline, but I need to see
on the meddle logs what are these 3G messages. I cannot get them from
my setup. I guess that the VPN is using keep alive message every 45
seconds. As the 3G connection never sleep, receiving such a packet
trigger the wake-up of the \wifi{} interface. When 3G is disabled, the
keep alive messages cannot prevent the \wifi{} interface to
sleep. Ashwin, if you are aware of such a timer in your VPN config, we
can safely state my guess in the paper.}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_vpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} enabled, and VPN
          enabled.}
  \label{fig:push_wv_ts}
\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_vpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} and 3G enabled, and VPN
          enabled.}
  \label{fig:push_w3v_ts}
\end{figure}

\subsection{Case Study Longitudinal Measurements - Google Search }
\label{sec:case-study-google}



% 1353489965.972204       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      1       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=a      -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       356     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.199133       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      2       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=aw     -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       321     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.471227       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      3       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awe    -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       300     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.881255       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      4       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awes   -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       301     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489967.365324       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      5       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=aweso  -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       302     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.001541       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      6       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesom -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       303     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.303481       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      7       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome        -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       304     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.469449       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      8       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+       -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       330     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.221635       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      9       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+t      -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       345     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.551634       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      10      GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+to     -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       390     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.953698       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      11      GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+to+    -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       383     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -


\begin{table}
\begin{center}
\begin{tabular}{|c|c|l|}
\hline
Time & Bytes & Query \tabularnewline
 & Downloaded & String\tabularnewline
\hline 
1353489965.97 & 356 & a \tabularnewline
\hline
1353489966.19& 321 & aw\tabularnewline
\hline
1353489966.47& 300 & awe\tabularnewline
\hline
1353489966.88& 301 & awes\tabularnewline
\hline
1353489967.36& 302 & aweso\tabularnewline
\hline
\end{tabular}
\end{center}
\caption{Table}
\label{tab:ExampleGoogleSearch}
\end{table}
We now use Google search as an example of longitudinal studies that
are possible using using Meddle.

In \fref{tab:ExampleGoogleSearch} we present a sample search session on
Android 4.0. During this sesssion, we observe that each key stroke by
the user resulted in a unique GET query made to a Google server. We
observe similar behavior on Android 4.0, Android 4.1, and Android 4.2
\tbd{confirm}. In the case of iOS devices we observed search queries
in the clear on devices running iOS 5. On devices running iOS 6 we
observe that search queries take place over SSL. \tbd{Privacy similar
  to desktop sentence.}


\subsection{Case Study Filtering Intrusive Traffic}
\label{sec:case-study-filtering}

\subsection{Case Study Traffic Optimization - Compression}
\label{sec:case-study-compression}

\subsection{Case Study Suspicious Apps}
\label{sec:case-study-susp}









 




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
