\section{Characterizing Mobile Traffic}
\label{sec:measurement-results}

%\subsection{Dataset Description}
%\label{sec:dataset-description}
%
%- IRB based study from September 2012. 
%- Full packet capture
%- Currently serves 20 devices from 14 users, 8 Android, 12 iOS device,    
%  4 iPads, 7 iPhones, and 1 iPod Touch.
%  15 service providers spread across US and France.
%- 30.2 GB of Traffic Volume from November 1, 2012

\subsection{Descriptive Statistics}
\label{sec:initial-results}

In this section, we use several descriptive statistics to 
summarize our dataset and provide context for the remainder 
of the section. We focus on the type of traffic being generated, 
how it varies per OS and how it varies over different access technologies.

\noindent\textbf{Comparing across OSes.}
A key advantage of our approach is that it allows passive network 
monitoring across multiple OSes. In contrast, studies that rely on a custom, modified 
OS can monitor only that OS.
Table~\ref{tab:summaryIOSAndroidTraffic} examines the portion of 
traffic using several key protocols for iOS and Android devices. 

We classify IP flows as either TCP, UDP, or other. We further classify TCP flows as either HTTP, SSL, or
other. The SSL flows include HTTPS, IMAP, and other services that rely
on SSL to secure the connection between the mobile client and the
remote server. TCP flows that are not classified
as either HTTP or SSL are classified as other.  


\begin{table}
\begin{center}
\begin{tabular}{|l|l|r|r|r|r|}
\hline
\multirow{2}{*}{\bf Protocol} & \multirow{2}{*}{\bf Service} & \multicolumn{2}{|c|}{\bf Android} & \multicolumn{2}{|c|}{\bf iOS} \tabularnewline
\cline{3-6}
           &           &  \textbf{Flows}  &  \textbf{Bytes}  &  \textbf{Flows}  &  \textbf{Bytes}  \tabularnewline
\hline
 TCP       &  HTTP     &  14.87  &  74.31  &  16.07  &  82.01  \tabularnewline
\hline
TCP       &  SSL      &  37.19  &  24.35  &  37.64  &  17.31  \tabularnewline
\hline
 UDP       &  -        &  40.52  &   0.98  &  42.34  &   0.49  \tabularnewline
\hline
 TCP       &  other    &   2.08  &   0.22  &   1.13  &   1.89  \tabularnewline
\hline
 Other     &  -        &   5.35  &   0.14  &   2.82  &   0.09  \tabularnewline
\hline
\multicolumn{2}{|c|}{\emph{total}} & 100.00 & 100.00 & 100.00 & 100.00 \tabularnewline
\hline
\end{tabular}
\end{center}
\caption{Percentage of flows and bytes from iOS and Android devices. \tbd{Verify total 100
    for final results} \emph{SSL is responsible for the majority of
    TCP flows from iOS and Android devices.}} 
\label{tab:summaryIOSAndroidTraffic}
\end{table}

First, we observe that DNS is responsible for more 93.5\% of
the UDP flows. The rest of the flows are due to services such as
Skype. 
%421310/449421 

Second, we observe that most TCP traffic
traffic is HTTP(S), in line with previous results. Third, the majority 
of byes are transferred over unencrypted channels. This is mainly 
due to streaming video (\eg, Netflix and YouTube) over HTTP. 

Last, we find the majority 
of TCP flows are sent over SSL, and these fraction is nearly identical 
for Android and iOS. We believe this occurs across platforms because 
the majority of flows come from e-mail, messaging and social networking, 
all of which use secure channel regardless of the OS.  

On balance the number of bytes transferred per unit time in Android, 
and the number of flows, is larger than the same for iOS. This can be 
explained by the relatively permissive API for running code in the 
background on Android. In contrast, iOS quickly kills processes that 
are in the background, preventing them from generating network 
traffic after only a few seconds of losing the foreground.
\tbd{@Ashwin: We need stats}



\begin{table}
\begin{center}
\begin{tabular}{|l|l|r|r|r|r|}
\hline
\multirow{2}{*}{\bf Protocol} & \multirow{2}{*}{\bf Service} & \multicolumn{2}{|c|}{\bf Wi-Fi} & \multicolumn{2}{|c|}{\bf Cellular} \tabularnewline
\cline{3-6}
           &           &  \textbf{Flows}  &  \textbf{Bytes}  &  \textbf{Flows}  &  \textbf{Bytes}  \tabularnewline
\hline
 TCP       &  HTTP     &  16.91  &  83.52  &  13.03  &  56.14  \tabularnewline
\hline
 TCP       &  SSL      &  38.18  &  15.83  &  36.14  &  41.42  \tabularnewline
\hline
UDP       &  -        &  41.43  &   0.49  &  41.56  &   1.67  \tabularnewline
\hline
TCP       &  other    &   1.38 &   0.16  &   1.95  &   0.4  \tabularnewline
\hline
Other     &  -        &   2.12  &  0.01  &   7.2  &   0.3  \tabularnewline
\hline
\multicolumn{2}{|c|}{\emph{total}} & 100.00 & 100.00 & 100.00 & 100.00 \tabularnewline
\hline
\end{tabular}
\end{center}
\caption{Percentage of flows and bytes using Wi-Fi and Cellular as access technology. \tbd{Verify total 100
    for final results} \emph{The share of SSL traffic over Cellular
    networks is larger than its share over Wi-Fi.}}  
\label{tab:summaryWifiCellularTraffic}
\end{table}


\noindent\textbf{Comparing across access technologies.} Another 
key advantage of \meddle is that it allows us to passively monitor traffic 
regardless of whether a device is on \wifi or cellular, without 
needing any OS modifications or imposing any constraints on 
user mobility. In contrast, studies relying on traffic seen over campus \wifi~\cite{chen:wifi} miss traffic 
over cellular connections; those from cellular providers miss \wifi traffic. 
As a point of reference, we found that the portion of network flows 
generated by devices were nearly equally split (60/40) between 
\wifi and cellular.

In \fref{tab:summaryWifiCellularTraffic}, we summarize the network 
traffic generated by \meddle-enabled devices over \wifi and cellular.
The first key observation is that the portion of HTTP bytes sent over \wifi and cellular 
are significantly different. Upon further inspection, we found that Wi-Fi is the
preferred medium to transfer media content, which generates relatively large flows. 
Another key reason is that apps such as
Google Plus (image backup on Android) allow users to upload their
images only over Wi-Fi. 

The portion of ``other'' flows for cellular is a relatively large 7.2\%. This occurs because 
several users run \emph{Mobiperf}, an application that performs regular network-measurement 
tests only over cellular connections.

%SSL traffic is typically compressed - discussion on compression
%opportunities for HTTP over Cellular networks refer to section ... for
%more details. We can refer to this section to introduce
%compression.

\noindent\textbf{Enabling direct performance comparisons.} 
Historically, cellular performance has lagged significantly behind 
\wifi, mainly for capacity reasons. With the advent of LTE and the 
increased interference from dense \wifi deployments, we ask whether 
this common knowledge remains valid. 

Previous work by Sommers et al.~\cite{sommers:cellwifi} investigated 
this question using SpeedTest results from a metro area, but did not 
have sufficient location accuracy to directly compare performance over 
\wifi and cellular for the same device. They found better performance 
from \wifi in the vast majority of cases. 

To directly compare \wifi and cellular performance for the same device, 
we determine the maximum transfer rate per hour for each device, 
then focus on cases where there was a sample for \wifi and cellular in 
the same hour. We focus on users that transferred more than 100\,MB of 
data in a single month. Figure~\ref{fig:datarates} depicts the median 
and quartiles of these peak rates. The graph shows that for many users 
(left side of the figure) \wifi is better than cellular. However, users on the right 
side often have better peak transfer rates over cellular -- mainly due to 
adoption of LTE. For user 4, however, we see that \wifi performance is 
poor compared to other users, indicating that users may see better 
connections over cellular connections even if they are 3G or older.

\begin{figure}
\centering
        \includegraphics[width=\linewidth]{./plots/dataRate.pdf}
  \caption{Median and quartile peak transfer rates for users when on \wifi 
  compared to cellular. Many users see significantly better performance 
  from \wifi; however, users with LTE often receive better performance over 
  cellular than \wifi.}
  \label{fig:datarates}
\end{figure}

\subsection{Case Study: Device Specific Apps (iOS Push)}
\label{sec:case-study-ios}

In this section, we present the results of a detailed case study 
of iOS push. We focus on this application because it represents 
an OS-managed service on an operating system that received 
little research attention due to its closed-source nature. 

We set out to answer the following questions: (1) What is the 
empirical network impact of push notifications and does the 
measured activity coincide with published documentation?
(2) Using \meddle, is there any relevant data traffic that is 
not captured by the VPN tunnel? (3) What is the impact of 
a VPN connection on network behavior? (4) Can we use 
network traffic alone to infer the state of the device?

\noindent \textbf{iOS Push Under the Microscope.} 
The Apple Push Notification Service 
(APNS) implements push for iOS. The documentation for APNS provides limited details about 
the implementation, but does specify expected behavior (\eg, push 
connections are established over cellular connections even if 
\wifi is available). 

We explicitly verified all provided documentation and confirmed that 
all statements are true with the exception of the notification behavior 
with an iPad. The documentation states that the iPad will always 
remain associated with a \wifi AP, even if it is not plugged in. Our 
experience shows this is not the case on an iPad 2.

We now further investigated 
the behavior of iOS push over time for three characteristic users. Figure~\ref{fig:pushHourly} 
plots this in terms of median number of push notifications received per 
user per hour. During the period, all users were in the same time zone.

\begin{figure}
\centering
        \includegraphics[width=\linewidth]{./plots/iosPushHourDistrib.pdf}
  \caption{Median number of push notifications seen per hour for three devices.}
  \label{fig:pushHourly}
\end{figure}

First, the figure shows that all three users see significant numbers of push 
notifications even in idle, overnight periods. It is unclear what the value of 
such traffic is. Second, we clearly see significant differences in the volume 
of traffic among users. User 1 has registered to receive push notifications 
from multiple apps, while Users 2 and 3 have not. Last, we note that even 
with iOS 6's ``do not disturb'' (DND) feature, push notifications continue to be 
sent during DND periods. Specifically, User 2 has enabled DND between 
midnight and 7am, but there is no noticeable change in APNS traffic.
In summary, we can use \meddle to help understand the network 
behavior of closed systems; further, we identify several opportunities 
where we believe the OS can reduce or eliminate push traffic (during idle periods).


% DRC: This contradicts results presented later.
%\tbd{Are we sure that devices are getting SMS notifications to connect to an apple server?}
%When a push notification is received, the iOS device connects to port
%5223 of a nearby Apple server. For each iOS device in our dataset, we
%logged the timestamp at which these connections were established. From
%this set of connections, we then selected the connections established
%between midnight and 6 am of the users local time. For each user, we
%computed the median of time interval between successive
%connections. We observe this median to be in the range of 190 seconds
%to 590 seconds. This time interval depends on the different apps for
%which the user has enabled notifications. 
%\tbd{Add figure}
%
%A user can disable notifications for specific time intervals on
%devices running iOS 6. In our dataset, three devices had notification
%disabled during different time intervals. During these time intervals
%we did not observe any traffic for notifications.

\noindent\textbf{Interaction between \meddle and the power management
  policy on iOS.}
In the remainder of this section, we perform controlled experiments 
to understand the interaction between \meddle's VPN connection and the power
management policy on iOS. In summary, we find that the impact of the VPN depends 
on the power state and network interfaces used (\wifi or cellular) on the
device -- but we show that the current power management policy on iOS
might adversely impact the energy consumption when the APNS is heavily used.
Further, we find that the changes in traffic patterns are relatively 
easy to identify, meaning \emph{we can use traffic from \meddle to infer 
when a device is plugged in and which access technologies are 
available}.

All the following experiments are performed on an \iphone 4 with iOS
6.0.1.  At the beginning of each experiment we close all applications
and restart the \iphone{}. The \iphone{} is connected in \wifi{} to a
controlled access point on which we perform a tcpdump on the \wifi{}
interface and monitor the \wifi{} association between the access point
and the \iphone{}. Each experiment lasts for around 1 hour. 

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_novpn_interTs.eps}
  \caption{Distribution of the interarrival times of Ethernet frames
    for a one hour experiment with an idle \iphone{} plugged-in, with \wifi{} and cellular
    enabled, and no VPN enabled. For each bin of 1 second, we count
    the number of interarrivals in that bin.}
  \label{fig:push_w3p_interTs}
\end{figure}

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_novpn_ts.eps}
%        \caption{Cumulative distribution of the Ethernet frames
%          arrival with time for a one hour experiment with an idle
%          \iphone{} plugged-in, with \wifi{} and 3G enabled, and no VPN
%          enabled.}
%  \label{fig:push_w3p_ts}
%\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_vpn_interTs.eps}
  \caption{Distribution of the interarrival times of Ethernet frames
    for a one hour experiment with an idle \iphone{} plugged-in, with \wifi{} and cellular
    enabled, and VPN enabled. For each bin of 1 second, we count
    the number of interarrivals in that bin.}
  \label{fig:push_w3pv_interTs}
\end{figure}

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_plug_vpn_ts.eps}
%  \caption{Cumulative distribution of the Ethernet frames
%          arrival with time for a one hour experiment with an idle
%          \iphone{} plugged-in, with \wifi{} and 3G enabled, and VPN
%          enabled.}
%  \label{fig:push_w3pv_ts}
%\end{figure}

\noindent\emph{Behavior when plugged in.} When an \iphone{} is plugged-in, it always remains associated with the
\wifi{} access point if \wifi{} is enabled on the device. We performed
a first set of experiments to observe the traffic to and from an idle
\iphone{}. We see in Fig.~\ref{fig:push_w3p_interTs} and
Fig.~\ref{fig:push_w3pv_interTs} that the largest interarrival between
two frames is in the order of 10 seconds for both the VPN and no VPN
scenarios. We also observe no noticeable difference in the arrival of
frames with time for both scenarios. (The corresponding figures are 
omitted for space reasons.)
%(see Fig.~\ref{fig:push_w3pv_ts} and
%no VPN (see Fig.~\ref{fig:push_w3p_ts}) scenarios. 
\emph{Thus, it appears that the VPN connection has no noticeable
  impact on network traffic pattern when the device is plugged in.}

%We don't claim this
%traffic to be typical, in particular, our access point is a Windows 7
%machine sending SSDP traffic to announce available services. Instead,
%we use it to understand in our experimental setup the background
%traffic.

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_novpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{} and 3G
%    enabled, and no VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_w3_interTs}
%\end{figure}


\noindent\emph{Behavior when on battery.} 
In a second set of experiments, we consider a default \iphone{}
setting with cellular and \wifi{} enabled, and the \iphone{} unplugged. This
corresponds to a typical setting for a user on move.  We observed 
relatively large interarrival times for frames in this case (many on the order of 100s of 
seconds). These cases correspond to
periods during which the \wifi interface of the \iphone{} is not
associated to the access point for energy saving. 



\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_novpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} and cellular enabled, and no VPN
          enabled.}
  \label{fig:push_w3_ts}
\end{figure}

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_novpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{} 
%    enabled, and no VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_w_interTs}
%\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_novpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} enabled, and no VPN
          enabled.}
  \label{fig:push_w_ts}
\end{figure}

Surprisingly, even though the \iphone{} is idle, the traffic pattern
is not regular (Fig.~\ref{fig:push_w3_ts}). To
understand this irregularity, we made a new experiment with cellular
disabled. The largest
interarrival is still in the order of 550 seconds, as in the case with
cellular enabled, but we have less variety in the interarrival times. This
is confirmed by Fig.~\ref{fig:push_w_ts} that shows a regular
succession of short periods during which frames are exchanged and long
periods during which the wifi interface is not associated to the
access point.

Therefore, there is an evidence that the cellular connection triggers
the association of the \iphone{} \wifi interface with the access
point. This is confirmed by experiments we performed with iMessage, 
which uses the push notification infrastructure of Apple. When both
cellular and \wifi{} are enabled on an \iphone{}, a permanent connection to
the push notification infrastructure of Apple is setup on the cellular
interface. Each time an iMessage is received, it is piggybacked on the
push notification message (when short enough). Interestingly, the \wifi{}
interface is always woken-up even if no payload is sent on it. We
don't know the exact reason for this behavior, but it may have an
adverse impact of battery life for users with frequent push
notifications, \eg, heavy users of SMS, twitter, facebook, games, \etc

In summary, APNS allows apps to interact with the user despite a strict energy-saving policy that 
prevents apps running in the background; however, \emph{the systematic wake up of
the wifi interface might lead to an unnecessary severe increase in power
consumption}. 


%We observed this same behavior on the tcpdump traces used to plot
%Fig.~\ref{fig:push_w3_ts}. We observe that the \wifi{} interface is
%woken-up (we observe a specific ARP and DHCP exchange that takes place
%for each \wifi{} association to the access point), but no payload is
%exchanged. In this case, as we do not use a VPN, we cannot monitor the
%3G traffic using \meddle{}, but we guess that traffic received on the
%3G interface trigger the wake of the \wifi{} interface. We plan to
%further explore this issue. 

%\begin{figure}
%\centering
%        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_vpn_interTs.eps}
%  \caption{Distribution of the interarrival times of Ethernet frames
%    for a one hour experiment with an idle \iphone{} unplugged, with \wifi{}
%    enabled, and VPN enabled. For each bin of 1 second, we count
%    the number of interarrivals in that bin.}
%  \label{fig:push_wv_interTs}
%\end{figure}




\noindent\emph{Behavior when \meddle is enabled.} We performed a third set of experiments with the VPN enabled. This set
of experiments shows the interaction between \meddle 
and the power management policy. We see in
%Fig.~\ref{fig:push_wv_interTs} and 
Fig.~\ref{fig:push_wv_ts} that
there is no noticeable differences when enabling \meddle with \wifi{} only. However,
when enabling both \wifi and cellular the frames interarrival time
%(Fig.~\ref{fig:push_w3v_interTs}) 
and the cumulative arrival of frames (Fig.~\ref{fig:push_w3v_ts}) is
significantly different. This difference between scenarios with and
without cellular is due to the persistence of the cellular connection. Indeed, on
the one hand, if messages are sent to the device when the cellular connection is disabled,
they will be lost if the \wifi interface is sleeping. Therefore, the
\wifi association periods are triggered by an internal device policy
only. On the other hand, when the cellular connection is enabled, all
messages sent to the device will be received. If the \wifi interface
is sleeping, messages received on the cellular interface will wake up the
\wifi interface. In that case, the \wifi association periods are not
only triggered by an internal device policy, but by external events
too, which explains the very different interarrival times seen in
Fig.~\ref{fig:push_w3_ts} and Fig.~\ref{fig:push_w_ts}, and in
Fig.~\ref{fig:push_wv_ts} and Fig.~\ref{fig:push_w3v_ts}.

The main question that remains is: what are these messages received on
the cellular interface? In Fig.~\ref{fig:push_w3v_ts}, we observe a pattern
with a periodicity of around 45 seconds. This pattern does not exist
when the VPN is disabled as shown in Fig.~\ref{fig:push_w3_ts}. We
conclude that this periodicity is mostly due to keep alive messages of the
VPN for NAT traversal. In Fig.~\ref{fig:push_w3_ts}, we observe what looks like
a random wake up of the \wifi interface when the VPN is disabled. We
explored tcpdump traces for this scenario and for the scenario with
the VPN enabled, looking for messages that explain the apparent
randomness, but we did not find any such messages. Therefore, we guess
that packets that do not use the VPN tunnel are received on the cellular 
interface. Such packets might be sent by the cellular provider to the
device. 

 
% \tbd{It will probably be too short for the deadline, but I need to see
% on the meddle logs what are these 3G messages. I cannot get them from
% my setup. I guess that the VPN is using keep alive message every 45
% seconds. As the 3G connection never sleep, receiving such a packet
% trigger the wake-up of the \wifi{} interface. When 3G is disabled, the
% keep alive messages cannot prevent the \wifi{} interface to
% sleep. Ashwin, if you are aware of such a timer in your VPN config, we
% can safely state my guess in the paper.}

In conclusion, though \meddle appears to capture all IP traffic it may
miss traffic in the circuit switched network when a cellular connection is enabled.

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_unplug_vpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} enabled, and VPN
          enabled.}
  \label{fig:push_wv_ts}
\end{figure}

\begin{figure}
\centering
        \includegraphics[width=0.8\linewidth]{../../code/pushNotification/Fig/bw_iphone_wifi_3g_unplug_vpn_ts.eps}
  \caption{Cumulative distribution of the Ethernet frames
          arrival with time for a one hour experiment with an idle
          \iphone{} unplugged, with \wifi{} and cellular enabled, and VPN
          enabled.}
  \label{fig:push_w3v_ts}
\end{figure}


\subsection{Case Study: Longitudinal Measurements - Google Search }
\label{sec:case-study-google}



% 1353489965.972204       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      1       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=a      -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       356     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.199133       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      2       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=aw     -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       321     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.471227       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      3       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awe    -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       300     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489966.881255       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      4       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awes   -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       301     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489967.365324       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      5       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=aweso  -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       302     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.001541       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      6       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesom -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       303     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.303481       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      7       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome        -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       304     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489968.469449       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      8       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+       -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       330     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.221635       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      9       GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+t      -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       345     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.551634       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      10      GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+to     -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       390     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -
% 1353489969.953698       7S1qUBBGGUg     24.19.59.238    45867   173.194.79.138  80      11      GET     suggestqueries.google.com       /complete/search?hl=en&ds=yt&client=androidyt&hjson=t&oe=UTF-8&q=awesome+to+    -       Apache-HttpClient/UNAVAILABLE (java 1.4)        0       383     200     OK      -       -       -       (empty) -       -       -       -       -       application/json; charset=UTF-8 chunked text/plain      -       -


%\begin{table}
%\begin{center}
%\begin{tabular}{|c|c|l|}
%\hline
%Time & Bytes & Query \tabularnewline
% & Downloaded & String\tabularnewline
%\hline 
%1353489965.97 & 356 & a \tabularnewline
%\hline
%1353489966.19& 321 & aw\tabularnewline
%\hline
%1353489966.47& 300 & awe\tabularnewline
%\hline
%1353489966.88& 301 & awes\tabularnewline
%\hline
%1353489967.36& 302 & aweso\tabularnewline
%\hline
%\end{tabular}
%\end{center}
%\caption{Table}
%\label{tab:ExampleGoogleSearch}
%\end{table}
A key advantage of our approach is that we can monitor app behavior 
over time and as updates occur. This can lead to surprising or otherwise 
unpublicized revelations about network activity.

One prominent example is Google searches from mobile devices. In the 
desktop environment, we have grown accustomed to these searches 
occurring over HTTPS connections, which protects user privacy from 
carriers and from other users at open \wifi hotspots. 

In the mobile environment, however, we noticed that the default 
browsers on iOS and Android send user queries in the clear. In fact, 
each letter is sent as the user types it for the purpose of Google Suggestions. 
We
observed this behavior on Android 4.0, Android 4.1, and Android 4.2
\tbd{confirm}. In the case of iOS devices we observed search queries
in the clear on devices running iOS 5. 

Interestingly, as of iOS 6 these searches are now sent using HTTPS, addressing 
a significant privacy vulnerability. To the best of our knowledge this 
change has not been publicized. Surprisingly, Google's own operating 
system's default browser has not made the change to HTTPS for searches.

%We now use Google search as an example of longitudinal studies that
%are possible using using Meddle.
%
%In \fref{tab:ExampleGoogleSearch} we present a sample search session on
%Android 4.0. During this sesssion, we observe that each key stroke by
%the user resulted in a unique GET query made to a Google server. We
%observe similar behavior on Android 4.0, Android 4.1, and Android 4.2
%\tbd{confirm}. In the case of iOS devices we observed search queries
%in the clear on devices running iOS 5. On devices running iOS 6 we
%observe that search queries take place over SSL. \tbd{Privacy similar
%  to desktop sentence.}


\subsection{Case Study: Misbehaving Apps and Filtering}
\label{sec:case-study-filtering}

    Smartphone users are often faced with the decision whether or not to trust an app downloaded from the iPhone App Store or the Android Market.
    While the user can access some information a priori regarding the app's behavior, \eg{} via reading reviews or inspecting the permissions requested,they ultimately can not know the app's behavior without installing it.
    While some undesirable app behavior is readily apparent -- \eg{} pushing advertisements to the notifications bar, installing unwanted third-party software, \etc{} -- the app's network behavior remains invisible to the user even after installation.
    With this in mind, we used {\it Meddle} to perform a short app-by-app analysis of network usage behavior.
    
    To start, we defined the network usage properties we desired from a `well behaved' app:
    \begin{itemize}
        \item Protection of personally identifiable information (PII): transmitting PII only when required for application functionality, and if transmitting PII, doing so over HTTPS rather than HTTP.
        \item Conservation of power and data quota by making only necessary use of network.
        \item Communication only with servers needed for the applications intended purpose, with preferably a limited number of entities contacted by the app overall.
    \end{itemize}
    We then downloaded six of the most popular apps from the Android Market, installed them on an fresh install of Android \tbd{x.y.z}. 
    One was a popular game, one was the app for a widely used image sharing site, one was a `weather' app, one was a settings management app, one was the app for a popular movie, and the final was a risqu\'{e} app serving various images. 

    The movie app, the settings app, and the game app easily fit our provider.
    Over 30 minutes of active use with the movie app, the phone contacted Amazon, Google, and a single CDN provider; the median inter-packet transmission time was \tbd{x}.
    Over 30 minutes of active use with the settings app, the phone contacted Amazon, Google, a hosting service, and two CDN services; the median inter-packet transmission time was \tbd{y}.
    Over 30 minutes of active use with the game app, the phone contacted only Google and Amazon; while the median inter-packet transmision time was higher (\tbd{z}), we presume this was needed for updating the game scoreboard at the end of each game.\tbd{Amy, is this a reasonable estimate?}

    The image-sharing and weather app we classified as likely non-malicious. They did not leak any PII in their traffic traces, however, they did violate our expectations of well-behaved apps. The risu\'{e} app we classified as malicious, however its network behavior only violated our expectations in one dimension. 
    Time plots of network traffic for these three apps are shown in Figure~\ref{fig:amy}.

    The image-sharing service violated our definition of a well-behaved app by contacting too many entities and generating too much trafic. 
    During 30 minutes of use, the phone contacted 10 CDNs, exposing the user's browsing behavior to a large number of organizations.
    %The phone also contacted Google, StumbleUpon, Twitter, and Facebook all upon startup; we presume this was for linked login services.
    Further, the inter-packet arrival time was a median of \tbd{alpha}, resulting in sustained network usage and potentially impacting battery life.

    The weather app similarly contacted a large number of CDNs and organizations, for a total of 10 organizations contacted.
    Not only does this network footprint raise concerns about exposure to numerous entities, but furthermore, one of the organizations contacted explicitly serves as a tracking service; their homepage advertises universal tracking for smartphone devices.
    Although they advertise this service for fraud prevention, it is hard to imagine what fraud prevention is necessary for a simple weather app.

    Finally, the risqu\'{e} app we did classify as malicious; it pushed advertisements to the notification bar and installed unwanted extra apps.
    However, its network profile was fairly benign.
    We observed no leaked PII. However, it did contact 19 entities including 7 CDNs and 4 advertising networks.
    This illustrates that monitoring network traffic is only part if the arsenal in monitoring app behavior.

    All three of our borderline apps contacted multiple ad network, thus a potential application of {\it Meddle}, which we discuss in the following section, is to simply filter all traffic to ad networks.
    To verify that blocking ad networks would not interfere with normal app behavior, we enabled filtering on the ad networks that the apps contacted, and manually tested each app's behavior...
    \tbd{more tomorrow.}

\subsection{Case Study: Traffic Optimization - Compression}
\label{sec:case-study-compression}

\tbd{Ashwin: point out cases where compression hurts. also show how much is already compressed.}








 




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% End: 
