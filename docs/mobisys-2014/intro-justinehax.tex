\section{Introduction}
\label{sec:introduction}

Today's mobile systems are walled gardens inside gated communities, \ie{} locked-down operating systems 
running on mobile devices that interact over an opaque mobile network. As a result, 
researchers and mobile-device users have little visibility into the network traffic generated by 
their devices, and have poor control over how, when and where that traffic is sent. 

This has serious negative implications for users: several previous studies~\cite{vallina-rod:ads,gerber:passivespeed,chen:wifi,enck:taintdroid,wang:middleboxes,sommers:cellwifi} 
identified privacy, performance, policy and security issues in mobile systems. However, each of these studies 
is limited in terms of visibility or control. For example, passively gathered datasets from large 
ISPs provide broad visibility but gives researchers no control over network flows (\eg to experiment with 
performance-enhancing proxies or malware blocking). Likewise, custom Android extensions provide 
strong control over network flows but measurement visibility is limited to the devices running these custom OSes or apps, many of which require warranty-voiding `jailbroken' software. 
To advance the state of the art in mobile systems, there is a need for a system that not only gives 
broad visibility into mobile network traffic to identify problems, but also gives control over these flows 
to build systems to address those problems.
Ideally, such a system would be easily deployable and usable for a typical smartphone users running any operating system.

This paper presents \meddle:  a platform for measuring and interposing on mobile-device (\eg smartphones and tablets) 
traffic regardless of where and how the device connects to the Internet. Our approach is to combine software middleboxes 
with VPN proxying, enabling our system to provide broad visibility and strong control over network flows from a mobile device. 

The vast majority of Internet-enabled mobile devices provide the ability to connect to a remote host over a virtual private network (VPN), so our system is readily deployable and usable. 
By redirecting all smartphone traffic over a VPN, \meddle provides a central vantage point for traffic monitoring.
Further, software middleboxes can provide strong control over flows going to and from each device, and even experiment with network services for mobile devices (\eg compression, content filtering, malware blocking, Web caching), quickly, easily and at scale~\cite{sherry:middleboxes}. %Move to related work?? without 
%the need to deploy hardware in homes~\cite{bismark} or ISPs~\cite{wang:middleboxes}, or 
%deploy custom OSes that require rooting phones~\cite{enck:taintdroid}. 

%\tbd{PG: reviewer says: does tunneling the traffic in this way impact the mobile ISPs ability to optimize their network? DC: Not sure this is the right place to address it but leaving the comment here for now.}

Meddle provides useful opportunities to both users and researchers.
To encourage users to install \meddle, we currently provide custom 
network filters (\eg device-wide ad blocking) and visualization/blocking of services leaking 
personally identifiable information (PII). We are developing additional services as incentives 
for users, including Web prefetching, device-wide SPDY proxying and malware blocking.
\meddle also provides researchers with a new, powerful platform for \emph{in situ} 
mobile-network research and experimentation. Currently researchers with new  
middlebox approaches to improve the mobile user experience must test them in a lab environment or 
rely on ISPs or users to deploy new hardware/software -- a potentially risky and costly 
proposition. With \meddle, researchers 
can immediately deploy new software middlebox services that interact with 
real users' mobile traffic (with user opt in). %in cloud data centers often located just outside each device's access network. 

This paper demonstrates the feasibility of our approach and explores several new opportunities 
for implementing network control to enable applications not broadly supported in today's mobile 
environment. This is a first step in our longer-term vision of improving network transparency and control 
in mobile systems by designing new network services.

Our key contributions are as follows. First, we design and implement \meddle, a system that provides users with transparency 
and control % PG: Make these words more general
over all Internet traffic generated by their 
mobile devices. We demonstrate that it is sufficiently transparent to avoid significantly impacting measurement results. 
\platname captures all Internet traffic with approximately 10\% power and packet overheads, and negligible additional latency. 
We will make the \platname software and configuration details open source and publicly available.

Second, we use \meddle as a vantage point to conduct measurement studies that inform 
middlebox applications that can meet a wide range of users' goals: identifying privacy leaks in mobile apps, detecting content 
manipulation and service differentiation in ISPs, and studying malicious mobile network activity. We analyze network traffic from controlled experiments for more than 1,200 apps (iOS and Android), 
and from human subjects during a 7-month study, comprising 21 users and 26 devices. To the best of our knowledge, this is the first study to report a holistic 
view of network traffic from real user devices running iOS and Android. These users interact with networks in 54 ASes,
%\tbd{PG: Is there a bias toward academic networks?/academics who travel a lot?}
8 of which are cellular; their traffic strongly depends on OS and network type.


Third, we implement applications atop \meddle that improve 
privacy, block unwanted traffic, notify users of ISP interference and block malware. 
In particular, we make available a new visualization tool, \emph{ReCon}, for users to track and control how 
they are being monitored by ad and analytics services. 
%A demo of our tool is located at \url{http://goo.gl/A17h9}. 
 We also develop new tools for detecting content manipulation by ISPs (Web Tripnets) and 
 service differentiation (Mobile Replay) in the mobile environment, whereas previous work focused on 
 fixed-line networks~\cite{reis:tripwires,dischinger:glasnost}. 
% PG: Flip 2&3 or merge
\meddle has been running since 
MONTH, 2012 and currently has XXX users participating in an IRB-approved study. 



%There is a tension between user and ISP control of network traffic, and \meddle shifts the control 
%toward the user. However, \meddle is not a wholesale replacement for existing middleboxes, nor do we intend it to permanently supersede 
%in-network deployments and the policies they implement. Rather, researchers 
%and developers can use \meddle test new ideas, understand the impact on both users and access networks, 
%then co-design new in-network middlebox solutions that jointly optimize for both users and networks. 



\noindent\textbf{Roadmap.} The rest of the paper is organized as follows. We present the goals and design principles for \meddle in \S\ref{sec:goals}, then 
discuss the implementation details in \S\ref{sec:impl}. We describe the datasets that we use in our evaluation in \S\ref{sec:dataset} and 
analyze these datasets to understand key properties on mobile device network behavior, and how to map network flows to the 
apps that generate them. We use these analyses to inform the design and implementation of several applications built atop \meddle. 
In \S\ref{sec:characterize-app}, we describe how we detect and block privacy leaks in mobile traffic. \S\ref{sec:isp-behavior} discusses 
how we use \meddle to detect ISP policies such as content manipulation and service differentiation, and \S\ref{sec:malware} details 
how we use \meddle to detect and block mobile malware. In \S\ref{sec:related} we discuss related work and we conclude in \S\ref{sec:conclusion}.

