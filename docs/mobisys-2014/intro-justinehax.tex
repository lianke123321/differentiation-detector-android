\section{Introduction}
\label{sec:introduction}

Today's mobile systems are walled gardens inside gated communities, \ie{} locked-down operating systems 
running on mobile devices that interact over networks with opaque policies. As a result, 
researchers and mobile-device users have little visibility into the network traffic generated by 
their devices, and have poor control over how, when and where that traffic is sent and handled by third parties. 

This situation has negative implications for users: previous studies  
identified privacy~\cite{vallina-rod:ads}, performance~\cite{gerber:passivespeed,chen:wifi,sommers:cellwifi}, policy~\cite{wang:middleboxes} and security~\cite{enck:taintdroid} issues in mobile systems. However, each of these studies 
is limited in terms of visibility or control. 
For example, passively gathered datasets from large mobile 
ISPs provide broad visibility but gives researchers no control over network flows (\eg to experiment with 
transparent proxies or malware blocking). Likewise, custom Android extensions provide 
strong control over network flows but measurement visibility is limited to the devices running these 
custom OSes or apps, often requiring warranty-voiding ``jailbreaking.'' 

To understand and address the above problems in mobile systems as they evolve over time, we 
need an approach that supports long-term studies of mobile Internet traffic and the ability to 
interpose on these flows. 
Ideally, such a system would be easy to deploy and use for a typical smartphone users 
running any operating system anywhere in the world.

This paper presents \meddle:  a platform for measuring and interposing on all mobile-device 
Internet traffic (\eg from smartphones and tablets). \meddle combines software middleboxes 
with VPN proxying, enabling both visibility and control over network flows. 

The vast majority of Internet-enabled mobile devices provide the ability to connect to a remote 
host over a virtual private network (VPN), so \meddle is readily deployable and usable. 
By redirecting all smartphone traffic over a VPN, \meddle provides a central vantage point for traffic monitoring.
Further, software middleboxes can provide control over flows going to and from each device, and even experiment 
with network services for mobile devices (\eg content filtering, malware blocking, Web proxying), quickly, easily and at scale using cloud infrastructure~\cite{sherry:middleboxes}. 
This paper demonstrates the feasibility of our approach and explores several new opportunities 
for implementing applications not broadly supported in today's mobile 
environment. 

%Move to related work?? without 
%the need to deploy hardware in homes~\cite{bismark} or ISPs~\cite{wang:middleboxes}, or 
%deploy custom OSes that require rooting phones~\cite{enck:taintdroid}. 

%\tbd{PG: reviewer says: does tunneling the traffic in this way impact the mobile ISPs ability to optimize their network? DC: Not sure this is the right place to address it but leaving the comment here for now.}

\meddle provides useful opportunities for both users and researchers.
This paper 
focuses on the research \meddle enables by providing \emph{in situ} access to 
user network flows. Currently researchers with new  
middlebox approaches to improve the mobile user experience must test them in a lab environment or 
rely on ISPs or users to deploy new hardware/software --- a potentially risky and costly 
proposition. With \meddle, researchers 
can immediately deploy new software middlebox services that interact with 
real users' mobile traffic (with user opt in). %in cloud data centers often located just outside each device's access network. 

To encourage users to install \meddle, we currently provide custom 
network filters (\eg device-wide ad blocking) and identification/blocking of services leaking 
personally identifiable information (PII). We are developing additional services as user incentives, 
including offloading network communication to the cloud and device-wide SPDY proxying.
%\meddle provides researchers with a novel platform for \emph{in situ} 
%mobile-network research and experimentation. 

Our key contributions are as follows. First, we design and implement \meddle, a system that provides transparency 
and control 
over all Internet traffic generated by their 
mobile devices. We demonstrate that it is sufficiently transparent to avoid significantly impacting measurement results. 
\platname captures all Internet traffic with approximately 10\% power and data overheads, and low additional latency. 
We will make the \platname software and configuration details open source and publicly available.

Second, we use \meddle to conduct measurement studies that inform 
a wide range of mobile middlebox applications: identifying privacy leaks in mobile apps, detecting content 
manipulation and service differentiation in ISPs, and studying network activity of mobile malware. We analyze network traffic from controlled experiments with more than 1,000 apps (iOS and Android), 
and from human subjects during a 9-month IRB-approved study, comprising 21 users and 26 devices. To the best of our knowledge, this is the first study to report a holistic view of network traffic from real user devices running iOS and Android and 
connecting to a variety of cellular and \wifi networks. These users interact with networks in 54 ASes,
%\tbd{PG: Is there a bias toward academic networks?/academics who travel a lot?}
8 of which are cellular; their traffic strongly depends on OS and network type.


Third, we implement applications atop \meddle that improve 
privacy, block unwanted traffic from ads and malware, and notify users of ISP interference. 
In particular, we make available a new visualization tool, \emph{ReCon}, for users to track and control how 
they are being monitored by ad and analytics services. 
%A demo of our tool is located at \url{http://goo.gl/A17h9}. 
 We also develop tools for detecting content manipulation by ISPs (Web Tripnets) and 
 service differentiation (Mobile Replay) in the mobile environment, building upon previous 
 work in these areas~\cite{reis:tripwires,dischinger:glasnost}. \meddle has been running since 
October, 2012 as part of an IRB-approved study, new users can sign up at \url{http://meddle.mobi}. 



%There is a tension between user and ISP control of network traffic, and \meddle shifts the control 
%toward the user. However, \meddle is not a wholesale replacement for existing middleboxes, nor do we intend it to permanently supersede 
%in-network deployments and the policies they implement. Rather, researchers 
%and developers can use \meddle test new ideas, understand the impact on both users and access networks, 
%then co-design new in-network middlebox solutions that jointly optimize for both users and networks. 



\noindent\textbf{Roadmap.} The rest of the paper is organized as follows. We present the goals and implementation for \meddle in \S\ref{sec:goals}, then evaluate it in terms of overhead and effectiveness as a vantage point for mobile traffic in \S\ref{sec:eval}. We use these analyses to inform the design and implementation of several applications built atop \meddle. 
In \S\ref{sec:characterize-app}, we describe how we detect and block privacy leaks in mobile traffic. \S\ref{sec:isp-behavior} discusses 
how we use \meddle to detect ISP interference with network traffic. In \S\ref{sec:related} we discuss related work and we conclude in \S\ref{sec:conclusion}.

