\section{Methodology and Dataset}
\label{sec:Methodology}
\tbd{A bit of concern about separating out the methodology and results section -- because there is so much data and so many different experiments, I worry that reviewers when readin the results will forget how we derived those results. And vice versa -- that the reviewer, whilst reading the methodology, will forget why they should care about the methods described. Wouldn't it be better to describe the results bit by bit, and explain the methodology in-line, as needed? --Justine}

In this section, we detail the data collection methodology of \platname and the datasets we collected.
Our objectives were both to characterize the Internet usage properties of both specific applications and platforms, as well as to more generally characterize typical Internet usage properties given user behavior.
Consequently, our measurements come in two categories: first, a set of controlled, deliberate experiments to study the properties of specific apps or platforms; and second, an $N$-month long `in the wild study' of traffic generated by real Internet users who ran the \platname software on their personal smartphones.

\subsection{Controlled Experiments}
  In our controlled experiments, we installed selected applications from Google Play/ theiPhone App Store on `clean slate' Android/iOS devices with the latest versions of their operating systems (Android Jellybean and iOS 5 respectively). 
  After installing the app, we engaged in controlled behavior -- detailed below -- with the app while running the \platname software. 
  After several minutes of interaction, we uninstalled the application and installed a new app.
  Our controlled experiments allowed us to study (1) bandwidth and battery impacts of iOS push notifications; (2) traffic patterns and usage for Android and iOS apps; and (3) leakage of personally identifiable information (PII) due to Android and iOS apps.

  {\bf iOS Push Notifications.}
  The applications running on iOS devices receive notifications from Web services using \emph{iOS push notification}. 
  Push notifications allow an application to alert the user of updates (\eg{}, Facebook messages) while the phone is idle/not in active use.
  iPhone users are typically warned not to enable push notifications for too many apps due to the potential for these background tasks to (1) consume bandwidth resources and (2) consume battery resources, all without any active user behavior.
  However, these warnings come with little quantification of exactly {\it how much} an application's push notifications might impact battery life or bandwidth; to date the research community has not measured these properties due to the closed-source nature of iOS and consequent difficulty to measure these properties.
  Nevertheless, with \platname we can monitor the traffic generated due to push notifications and thus quantify the impact of push notifications despite the iOS lockdown; to the best of our knowledge this is the first measurement characterization of iOS push notifications.

  Our experiments to study push notifications proceeded as follows:\tbd{...Ashwin?}

  The results of these tests can be found in \S\ref{sec:pushresults}.

  {\bf Android Applications.}
  Both Android and iPhone apps generate traffic to load and upload user data, app content, and advertisements.
  Although users are informed upon application installation whether or not an app is allowed to access the Internet, the user is unaware {\it what} data is sent, {\it how much} data is sent or accessed, or {\it with whom} the app communications.
  We define a `well-behaved' application as one which (a) makes limited use of network and battery resources (\ie{} by accessing little bandwidth and by batching traffic to allow radio shutdown during idle periods); (b) contacts only those servers necessary to perform application behavior (\ie{} contacting only a limited number of advertising networks and no tracking sites); and (c) not leaking any personally identifiable information over the network, (\ie{} using HTTPS whenever uploading needed private information like email addresses, and never uploading unnecessary personal information like address book contents or device IMEI). 
\tbd{Justine: I need your help to rewrite the text here. I have put some crappy text as placeholder.}

  We test how many applications actually meet these criteria of well-behaved network usage, we performed controlled experiments on blank Android smartphones, iteratively installing, playing with, and monitoring the behavior of hundreds of Android apps whilst running the \platname app in the background.
  We tested the top 100 most popular free Android apps manually -- installing each app by hand, entering user credentials for accounts like Facebook and Twitter, and toying with the app. In addition to this manual setup, we used an automatic test-click generator to further toy with the app. Afterwards, we uninstalled the app and reset the device.
  
  Android, unlike iOS, allows users to `side-load' third-party apps on to their device; consequently there are numerous third-party app markets on the web in addition to Google's official Play Store.
  To study these apps, we performed fully-automated tests on \tbd{~2000? Amy?} apps from a free, third-party app market.
  Our automation used the adb Android command shell to install each app, enable \platname, and start the app.
  The system then used Monkey~\cite{}\tbd{Amy, need a citation?} to perform a series of automatic clicks and key entries in the app over a period of \tbd{two minutes? Amy?}.
  The system then once again used adb to uninstall the app and reboot the device (thus ending all lingering connections and metadata from the previous app.)

  The results of these tests can be found in \S\ref{sec:androidresults}.

  {\bf iPhone Applications.}
\tbd{Dave/Ashwin: Complete the text here for iOS -- subset of apps}. 
Dummy text for the paragraph.
\tbd{Dave: Text Here}

\subsection{In The Wild}

Along with controlled experiments we also conducted a measurement study to characterize the mobile Internet in the wild.
We deployed two \platname servers in USA and one server in France. 
These servers tunnel Internet traffic using VPNs from 25 devices, belonging to 19 users who are volunteers for our IRB approved study.
To protect the identity of the users and their data, on each server we use public key cryptography to encrypt the files that log the data traffic that flow through the server. 
We call this dataset the \moball dataset. 

The 25 devices that contribute to the \moball dataset consists of 9 iPhones, 4 iPads, 1 iPodTouch, 10 Android phones, and 1 Android tablet.
Though \emph{tablets} can access the Internet via a cellular data connections, for the \moball we included tablets that only use \wifi to access the Internet.
The Android devices in this dataset include the Nexus, Sony, Samsung, and Gsmart brands.

This dataset consists of 190 days of data that flowed through our VPN servers; the number days for each user varies from 5 to 176 with a median of 33 days.

We estimate the access technology used by the mobile device by performing a \emph{WHOIS} lookup on the IP address used by the mobile client for creation of the VPN tunnel. 
We use the WHOIS databases available at \emph{whois.cmyru.com} and \emph{utrace.de} to get the ISP details.
We observe that ISPs that provide Internet access over cellular connections use dedicated ASes for cellular traffic. 
We use the information provided by the \emph{WHOIS} databases to manually classify the ASes used by the mobile devices to be either cellular or \wifi.
This classification gives incorrect results when mobile clients are served by a \wifi access point that internally uses a cellular connection to connect the Internet.
In this case, though the device uses \wifi to connect to the Internet, our servers will log the connection to be from a cellular ISP. 

\tbd{we need some wording and consitency for the usage of ISP -- for example ATT can provide cellular and DSL. Also mobile data cannot be used and we need some word for cellular data and wifi data and this must be defined in the dataset description.}

Based on the above classification of access technology and ISPs, our dataset consists of data traffic from 54 distinct ISPs, of which 10 provided cellular services.
Of the 19 devices that used cellular data, we observed that 16 devices restricted their cellular data traffic to one ISP each; the other three users used the services of four, two, and two ISPs respectively.
We observed that the devices in our dataset used a higher number of \wifi ISPs.
We observed a median of 4 \wifi ISPs per device with a maximum of 24 \wifi ISPs that were used by one device.
%The device that used \tbdv{24} distinct ISPs was used by a user who traveled across 6 different countries during the data collection process. 
This observation confirms our intuition that studies based traces from a single ISP~\cite{maier:mobtraffic, vallina-rod:ads}, shall not be able to analyze how specific users use mobile devices. 

\subsection{Discussion}

\tbd{In summary, ... }
