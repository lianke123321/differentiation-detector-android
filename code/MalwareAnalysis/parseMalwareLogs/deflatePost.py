import zlib
fh = open("http.log.mal.dave-manual-1","r")
fw = open("http.uncompress.dave-manual-1", "w")
for line in fh:
    line = line.split("\t")
    uid = line[1]
    mime_type = line[23]
    content_encoding = line[27]
    transfer_encoding = line[29]
    post_body = line[30]
    def_body = "-"
    if mime_type.find("zip") != -1:
        decode_body = post_body.decode('string-escape')            
        if (len(decode_body)>3):
            try:
                def_body = zlib.decompress(bytes(bytearray(decode_body)), 15+32)
            except:
                def_body = "-"
           # if def_body != "-":
           # print uid, mime_type, content_encoding, transfer_encoding, post_body, decode_body, len(decode_body),def_body.encode('string-escape')
    fw .write(str(uid)+str("\t")+str(def_body.encode('string-escape'))+"\n")
#          sys.exit(-1)
fw.close()
fh.close()
                
    
