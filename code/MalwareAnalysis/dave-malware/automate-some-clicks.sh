#!/bin/bash
#This script takes a directory name, reads all the apks in it.
# It installs each apk onto the phone. Then it runs a 10,000 monkey random actions.
# It then uninstalls and reflashes (with an image optionally).

fileList="./apkList.txt"
apkFolder="./apks/"
apkTimeStamp="./curr-apktimestamps.txt"
devicePassword="meddlepw"
wirelessDevice="wlan0"

cnt=0
apkCnt=`wc -l ${apkTimeStamp} | cut -d ' ' -f 1`
while read fileId
do
  if [ "${cnt}" -eq "${apkCnt}" ];
  then
      apkName=${apkFolder}/${fileId}
      echo "Time to test ${apkName}"
      break
  fi 
  cnt=$((cnt+1))
  echo "Skipping ${line} at index ${cnt}"
done < ${fileList}

packagename=$(aapt dump badging "${apkName}" | grep package | awk -F ' ' '{print $2}' | awk -F "'" '{print $2}')
adb shell monkey -p ${packagename} --pct-majornav 0 --pct-syskeys 0 --pct-appswitch 0 --kill-process-after-error --throttle 500 1000
mplayer /usr/lib64/libreoffice/share/gallery/sounds/train.wav
echo "Done"
