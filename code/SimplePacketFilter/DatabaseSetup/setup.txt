# Lines that begin with # are comments 
# Lines that begin with $>  indicate bash prompt
# Line that begin with mysql> indicate mysql prompt

$> mysql_secure_installation

# Set the root password and disable remote root login
# Steps taken from http://dev.mysql.com/doc/refman/5.1/en/adding-users.html

$> mysql --user=root -p 
pass: <root password> 
# I have used root for the time being

mysql> CREATE USER 'meddle'@'localhost' IDENTIFIED BY 'meddle';

mysql> CREATE DATABASE MeddleDB;


mysql> GRANT ALL ON MeddleDB.* TO 'meddle'@'localhost' WITH GRANT OPTION;

# FOR EACH meddle server. Avoid using meddle@*
mysql> GRANT ALL ON MeddleDB.* to meddle@sounder.cs.washington.edu IDENTIFIED BY <meddle password>
mysql> GRANT ALL ON MeddleDB.* to meddle@snowmane.cs.washington.edu IDENTIFIED BY <meddle password>

$> mysql -u meddle -p MeddleDB
Enter password: <meddle password>

#http://stackoverflow.com/questions/1420839/cant-connect-to-mysql-server-error-111
Edit /etc/mysql/my.cnf or the corresponding my.cnf for your mysql installation

Add iptables rules to ensure no one 
$> iptables -A INPUT -p tcp -s localhost --dport 3306 -j ACCEPT
$> iptables -A INPUT -p tcp --dport 3306 -j REJECT
  

mysql> CREATE TABLE UserConfigs (userID INT NOT NULL AUTO_INCREMENT PRIMARY KEY, userName VARCHAR(512), filterAdsAnalytics INT NOT NULL DEFAULT 0, UNIQUE(userName)) ENGINE="InnoDB";

mysql> CREATE TABLE UserTunnelInfo (rowID SERIAL PRIMARY KEY, userID INT NOT NULL, clientTunnelIpAddress VARCHAR(64) NOT NULL, clientRemoteIpAddress VARCHAR(64) NOT NULL, serverIpAddress VARCHAR(64) NOT NULL, timestamp TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, startStopFlag BOOLEAN NOT NULL DEFAULT 0) ENGINE="InnoDB"; 
#mysql> ALTER TABLE UserTunnelInfo ADD INDEX (timestamp);

# For each user add this entry to he table while creating users
mysql> INSERT INTO UserConfigs VALUES (0, 'arao-ipod', 0);


mysql> CREATE TABLE UserConfigChange(userID INT NOT NULL,  timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, configVariable VARCHAR (512), newValue VARCHAR (512)) ENGINE="InnoDB";

mysql> CREATE TABLE InterestedUsers(rowID SERIAL PRIMARY KEY, timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, emailAddress VARCHAR (512), responded BOOLEAN NOT NULL DEFAULT 0) ENGINE="InnoDB";  

