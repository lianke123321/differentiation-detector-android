# Lines that begin with # are comments 
# Lines that begin with $>  indicate bash prompt
# Line that begin with mysql> indicate mysql prompt

# Install mysql and its connector
# For Fedora
$> sudo yum install mysql-server mysql-client mysql-devel mysql-connector-python MySQL-python
# For Ubuntu/debian 
$> sudo apt-get install mysql-server mysql-client mysql-common python-mysqldb-dbg python-mysql libmysqlclient-dev

# Start the mysql service if it is not running. 
$> sudo service mysqld start

# If this is the first time mysql is being used then perform the secure installation to ensure that root password is set. 
$> sudo mysql_secure_installation

# Set the root password and disable remote root login
# The following steps have been taken from http://dev.mysql.com/doc/refman/5.1/en/adding-users.html
$> mysql --user=root -p 
pass: <enter_root_password_here> 

# Now we create an account with a username meddle and a password specified by meddle_password_for_this_server. Please remember the meddle_password_for_this_server. This password should be the one present in the dbPassword field in meddle.config file.
mysql> CREATE USER 'meddle'@'localhost' IDENTIFIED BY 'meddle_password_for_this_server';

# Create the Database with the name MeddleDB
mysql> CREATE DATABASE MeddleDB;

# Ensure that the user meddle can access the MeddleDB database
mysql> GRANT ALL ON MeddleDB.* TO 'meddle'@'localhost' WITH GRANT OPTION;

# This step can be ignored if only one server is used to serve the mobile clients. 
# When more than one server is used to serve the domain then for each meddle server 
# Avoid using meddle@*.
mysql> GRANT ALL ON MeddleDB.* to meddle@myserverhostname1 IDENTIFIED BY <meddle_password_for_this_server>
mysql> GRANT ALL ON MeddleDB.* to meddle@myserverhostname2 IDENTIFIED BY <meddle_password_for_this_server>

# Now login as meddle to check if the credentials work
$> mysql -u meddle -p MeddleDB
Enter password: <meddle_password_for_this_server>

# If you are not able to connect then edit the my.cnf based on the suggestions available at 
# http://stackoverflow.com/questions/1420839/cant-connect-to-mysql-server-error-111
# Edit /etc/mysql/my.cnf or the corresponding my.cnf for your mysql installation

# Add iptables rules to ensure that mysql is not accessed by anyone else. This step can be ignored.
$> iptables -A INPUT -p tcp -s localhost --dport 3306 -j ACCEPT
$> iptables -A INPUT -p tcp --dport 3306 -j REJECT
  
# Create the tables using the CreateTable.sql file

mysql -u meddle -p MeddleDB < CreateTables.sql

# Repeat the steps for .sql files in the PopulateDB/ folder 
# Hurray! Database is setup
