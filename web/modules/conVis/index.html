<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en-US" dir="ltr"> <!--<![endif]-->
  <head>
	<link href="index.css" rel="stylesheet" type="text/css">
  </head>

  <body>
  <div class="noselect" style="width:200px; position:absolute; top:0; left:20px;">
  <h1>Meddle - Connection Visualization<h1>
  <h3>Meddle makes it easy to see who your apps are talking to:</h3>
  <ul style="color: rgb(51,51,51); padding:0 0 0 15px;">
  	<li>Each circle with a shadow is an app</li>
  	<li>All other nodes are web services</li>
  	<li>Lines show the connections each app makes</li>
  	<li>Red circles are sites known to track users</li>
  	<li>Size shows how often each app or site is used</li>
  </ul>
  <h3>Explore the graph:</h3>
  <ul style="color: rgb(51,51,51); padding:0 0 0 15px;">
  	<li>Drag an empty part of the graph to move</li>
  	<li>Scroll the mouse wheel to zoom</li>
  	<li>Click a link to ban it</li>
  	<li>Hover to show only direct connections</li>
  </ul>
  <h5>Best viewed in Google Chrome</h5>
  </div>
	<div id="chart"><!-- The d3 layout graph will go inside this div -->
		<svg height="1000px" width="100%" style="opacity: 1;">
<g id="viewport">
			<defs>
				<marker id="Triangle" viewBox="0 0 10 10" refX="30" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto">
					<path d="M 0 0 L 10 5 L 0 10 z"></path>
				</marker>
				<radialGradient id="glow-gradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
					<stop offset="0%" style="stop-color:rgb(200, 240, 255);stop-opacity:1"></stop>
					<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:0"></stop>
				</radialGradient>
			</defs>		
			<g class="links"></g>
			<g class="nodes"></g>
			<path id="domain-label"></path>
			<text id="domain-label-text"></path>
</g>
		</svg>
	</div>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="script/graphrunner.js"></script>
	<script src="script/svgpan.js"></script>
	
	<script>
		function getQueryVariable(variable) {
		  var query = window.location.search.substring(1);
		  var vars = query.split("&");
		  for (var i = 0; i < vars.length; i++) {
		    var pair = vars[i].split("=");
		    if (pair[0] == variable) {
		      return unescape(pair[1]);
		    }
		  }
		}

/*		function updateGraphViaPostMessage(graph, target) {
		  target.postMessage("ready", "*");
		  $(window).one("message", function(event) {
		    graph.update(JSON.parse(event.originalEvent.data));
		  });
		}
*/
		$(window).ready(function() {
		  var graphUrl = getQueryVariable("graph_url");

		  $("#domain-infos").hide();
		  
		  $("svg").attr("height", window.innerHeight);

		  // get list of known trackers from trackers.json file hosted on website:
		  jQuery.getJSON("trackers.json", function(trackers) {
		    var runner = GraphRunner.Runner({
		      width: window.innerWidth/*640*/,
		      height: window.innerHeight/*480*/,
		      trackers: trackers,
		      hideFavicons: false 
		    });
		    var graph = runner.graph;

		    // Enable drag-and-drop to import collusion graph data from a json file:
		    $(document.body).bind("dragover", function(event) {
		      event.preventDefault();
		    }).bind("drop", function(event) {
		      event.preventDefault();
		      var files = event.originalEvent.dataTransfer.files;
		      if (files.length == 1) {
		        var reader = new FileReader();
		        reader.onload = function() {
		            graph.update(JSON.parse(reader.result));
		        };
		        reader.readAsText(files[0], "UTF-8");
		      }
		    });

		    $("#page").width(runner.width);

		    if (graphUrl) {
		      if (graphUrl == "opener") {
		        updateGraphViaPostMessage(graph, window.opener);
		      } else if (graphUrl == "parent") {
		        updateGraphViaPostMessage(graph, window.parent);
		      } else
		        jQuery.getJSON(graphUrl, function(data) {
		          graph.update(data);
		        });
		      return;
		    }
		  });
		});
	</script>
  </body>
</html>

